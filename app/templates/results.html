{% extends 'base.html' %}
{% block content %}

<div class="row justify-content-center page-content">
  <div class="col-12 col-md-10 col-lg-9">
    <div class="text-center mb-4">
      <h1>üìä {% if language == "fr" %}R√©sultat de l‚Äôanalyse{% else %}Analysis Result{% endif %}</h1>
      <p class="text-muted">{% if language == "fr" %}R√©sum√© de l‚Äôanalyse NLP & LLM{% else %}NLP & LLM Analysis Summary{% endif %}</p>
    </div>

    <!-- Texte analys√© -->
    <div class="card mb-5">
      <div class="card-header">
        üßæ {% if language == "fr" %}Texte analys√©{% else %}Analyzed Text{% endif %}
      </div>
      <div class="card-body">
        <pre class="text-wrap">{{ article_text }}</pre>
      </div>
    </div>

 <!-- Ligne Score + Entit√©s -->
<div class="row mb-5">
  <!-- Datafication Score -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center">
        üìà {% if language == "fr" %}Score de datafication{% else %}Datafication Score{% endif %}
        <button type="button"
                class="btn btn-sm btn-outline-secondary ms-2"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                title="{% if language == 'fr' %}Comment est calcul√© le score ?{% else %}How is the score calculated?{% endif %}"
                data-bs-content="{{ datafication_explanation }}">
          ?
        </button>
      </div>
      
      <div class="card-body">
        <p>
          <span class="badge {% if score.score >= 7 %}bg-success{% elif score.score >= 4 %}bg-warning{% else %}bg-danger{% endif %} fs-4">
            {% if language == "fr" %}Score{% else %}Score{% endif %} : {{ score.score }}/10
          </span>
        </p>
        <hr/>
        <div class="mt-3">
          <p class="fw-bold mb-1">
            {% if language == "fr" %}Densit√© :{% else %}Density:{% endif %} 
            <span class="text-primary">{{ score.density }}</span> 
            ({{ score.structured_items }} / {{ score.word_count }} {% if language == "fr" %}mots{% else %}words{% endif %})
          </p>
        <hr/>
          <p class="fw-bold mb-1">
            {% if language == "fr" %}Commentaire :{% else %}Commentary:{% endif %} <span class="text-primary">{{ score_comment }}</span>          
          </p>
          <hr/>
          <p class="fw-bold mb-1">
            {% if language == "fr" %}Profil √©ditorial :{% else %}Editorial Profile:{% endif %} 
            <span class="text-primary">{{ profile_label }}</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Entities Detected Summary -->
  <div class="col-md-6 mb-4">
    <div class="card h-100">
      <div class="card-header">
        üß† {% if language == "fr" %}R√©sum√© des entit√©s d√©tect√©es{% else %}Entities Detected Summary{% endif %}
      </div>
      <div class="card-body">
        <table class="table table-bordered table-hover text-start">
          <thead class="table-light">
            <tr>
              <th>{% if language == "fr" %}Type d'entit√©{% else %}Entity Type{% endif %}</th>
              <th class="text-center">{% if language == "fr" %}Nombre{% else %}Count{% endif %}</th>
            </tr>
          </thead>
          <tbody>
            {% for key, count in entity_counts.items() %}
              <tr>
                <td class="fw-bold">{{ key }}</td>
                <td class="text-center">
                  <span class="badge bg-primary">{{ count }}</span>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>



  <!-- Angles et Visualisations combin√©s -->
<div class="card mb-5">
  <div class="card-header">
    üß≠ {% if language == "fr" %}Suggestions d‚Äôangles journalistiques{% else %}Suggested Journalistic Angles{% endif %}
  </div>
  <div class="card-body">
    <ul class="list-group list-group-flush">
      {% for item in parsed_angles %}
        <li class="list-group-item">
          <strong>{{ item.title }}</strong><br>
          <span class="text-muted">{{ item.content | safe }}</span>

          <!-- Bouton Collapse pour Visualisation -->
          {% if item.visualization %}
          <button class="btn btn-outline-primary btn-sm mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#viz-{{ loop.index0 }}" aria-expanded="false" aria-controls="viz-{{ loop.index0 }}">
            {% if language == "fr" %}Voir la suggestion de visualisation{% else %}View Visualization Suggestion{% endif %}
          </button>

          <!-- Bloc Collapse -->
          <div class="collapse mt-2" id="viz-{{ loop.index0 }}">
            <div class="card card-body">
              <small class="text-muted">{{ item.visualization | safe }}</small>
            </div>
          </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>




    <!-- Sources -->
    <div class="card mb-5">
      <div class="card-header">
        üåê {% if language == "fr" %}Suggestions de ressources / datasets{% else %}Suggested Sources / Datasets{% endif %}
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for item in parsed_sources %}
            <li class="list-group-item">
              <strong>{{ item.title }}</strong><br>
              <span class="text-muted">{{ item.content | safe }}</span>

            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

   

    <!-- Actions -->
<div class="row mt-5">
  <!-- Exporter -->
  <div class="col-md-6 mb-3">
    <form method="POST" action="/download">
      <input type="hidden" name="article_text" value="{{ article_text }}">
      <input type="hidden" name="score" value="{{ score }}">
      <input type="hidden" name="score_comment" value="{{ score_comment }}">
      <input type="hidden" name="profile" value="{{ profile_label }}">
      <input type="hidden" name="entities" value="{{ entities }}">
      <input type="hidden" name="angles" value="{{ angles }}">
      <input type="hidden" name="sources" value="{{ sources }}">
      <button type="submit" class="btn btn-success w-100 btn-lg">
        üì• {% if language == "fr" %}
          Exporter l‚Äôanalyse (Markdown)
        {% else %}
          Export analysis (Markdown)
        {% endif %}
      </button>
    </form>
  </div>

  <!-- Analyser un autre -->
  <div class="col-md-6 mb-3">
    <a href="/" class="btn btn-outline-primary w-100 btn-lg">
      {% if language == "fr" %}
        ‚Üê Analyser un autre article
      {% else %}
        ‚Üê Analyze another article
      {% endif %}
    </a>
  </div>
</div>


{% endblock %}
